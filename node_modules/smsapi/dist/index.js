"use strict";function t(t){return t&&t.__esModule?t:{default:t}}var e=t(require("fs")),s=class{httpClient;constructor(t){this.httpClient=t}},a=t=>null!==t&&"object"==typeof t,n=(t,e)=>{if(void 0===t||!a(t))return t;const s={};return Object.entries(t).forEach(([t,a])=>{s[e(t)]=a}),s},r=t=>t.replace(/[A-Z]/g,t=>`_${t}`).replace(/[-\s]/g,"_").replace(/^_+|_+$/g,"").toLowerCase(),i=t=>t.toISOString().slice(0,10),o=t=>n(t,r),c=t=>{const{body:e,method:s,params:n}=t;if(n&&["get","delete"].includes(s.toLowerCase())){let e=((t,e)=>{if(void 0===t||!a(t))return t;const s={};return Object.entries(t).forEach(([t,a])=>{s[t]=e(a,t)}),s})(n,(t,e)=>"birthdayDate"===e?Array.isArray(t)?t.map(i).join(","):t instanceof Date?i(t):t:Array.isArray(t)?t.join(","):t);return e=o(e),{...t,params:e}}return!e||"object"!=typeof e||e instanceof FormData?t:{...t,body:o(e)}},p=class extends s{async get(){return await this.httpClient.get("/contacts/groups")}async getById(t){return await this.httpClient.get(`/contacts/groups/${t}`)}async create(t,e){return await this.httpClient.post("/contacts/groups",{name:t,...e})}async update(t,e){return await this.httpClient.put(`/contacts/groups/${t}`,e)}async remove(t,e=!1){await this.httpClient.delete(`/contacts/groups/${t}`,{params:{deleteContacts:e}})}},h=t=>t.date_created||t.date_updated?{...t,date_created:new Date(t.date_created),date_updated:new Date(t.date_updated)}:{...t},u=t=>{const{data:e}=t;return(t=>!!t.size&&!!t.collection)(e)?{...t,data:{collection:e.collection.map(t=>h(t)),size:e.size}}:{...t,data:h(e)}},d=class extends s{async get(){return await this.httpClient.get("/contacts/fields")}async create(t,e="text"){return await this.httpClient.post("/contacts/fields",{name:t,type:e})}async update(t,e){return await this.httpClient.put(`/contacts/fields/${t}`,{name:e})}async remove(t){await this.httpClient.delete(`/contacts/fields/${t}`)}},l=class extends s{fields;groups;constructor(t){super(t),this.httpClient.addRequestInterceptor(c),this.httpClient.addResponseInterceptor(u),this.fields=new d(this.httpClient),this.groups=new p(this.httpClient)}async get(t){return await this.httpClient.get("/contacts",{params:t})}async getById(t){return await this.httpClient.get(`/contacts/${t}`)}async create(t,e){return await this.httpClient.post("/contacts",{phone_number:t,...this.formatContactDetails(e||{})})}async update(t,e){return await this.httpClient.put(`/contacts/${t}`,{...this.formatContactDetails(e||{})})}async remove(t){await this.httpClient.delete(`/contacts/${t}`)}async getGroups(t){return await this.httpClient.get(`/contacts/${t}/groups`)}async getGroupById(t,e){return await this.httpClient.get(`/contacts/${t}/groups/${e}`)}async assignContactToGroup(t,e){return await this.httpClient.put(`/contacts/${t}/groups/${e}`)}async unpinContactFromGroup(t,e){await this.httpClient.delete(`/contacts/${t}/groups/${e}`)}formatContactDetails(t){const e=t;return t.birthdayDate&&(e.birthdayDate=i(t.birthdayDate)),n(e,r)}},m=class extends s{async check(t,e){const s={number:Array.isArray(t)?t.join(","):t};return e&&(s.idx=Array.isArray(e)?e.join(","):e),await this.httpClient.post("/hlr.do",void 0,{params:{format:"json",...s}})}},y=class extends s{async generateCode(t,e){return await this.httpClient.post("/mfa/codes",{phone_number:t,...e})}async verifyCode(t,e){return await this.httpClient.post("/mfa/codes/verifications",{code:e,phone_number:t})}};function w(t){return void 0!==t.error&&void 0!==t.message}var g=class extends Error{data;constructor(t){super(),Error.captureStackTrace(this,this.constructor),this.name="MessageError",this.data=t}},f=class extends s{endpoint;async send(t,e,s){const a={details:!0,encoding:"utf-8",format:"json",...this.formatSmsDetails(s||{})};if(this.isNumberRecipient(e)){const{to:t}=e;a.to=Array.isArray(t)?t.join(","):t}if(this.isGroupRecipient(e)){const{group:t}=e;a.group=Array.isArray(t)?t.join(","):t}if(this.isSms(t)&&(a.message=t.message.trim()),this.isMms(t)&&(a.subject=t.subject.trim(),a.smil=t.smil),this.isVmsText(t)&&(a.tts=t.tts.trim(),a.tts_lector=t.ttsLector||"ewa"),this.isVmsRemotePath(t)&&(a.file=t.remotePath),this.isVmsLocalFile(t)){const e=this.getFormDataForVmsLocalFile(a,t),s=await this.httpClient.post(this.endpoint,e);if(w(s))throw new g(s);return this.formatResponse(s)}const n=await this.httpClient.post(this.endpoint,a);if(w(n))throw new g(n);return this.formatResponse(n)}isNumberRecipient(t){return void 0!==t.to}isGroupRecipient(t){return void 0!==t.group}isSms(t){return void 0!==t.message}isMms(t){return void 0!==t.smil&&void 0!==t.subject}isVmsText(t){return void 0!==t.tts}isVmsLocalFile(t){return void 0!==t.localPath}isVmsRemotePath(t){return void 0!==t.remotePath}getFormDataForVmsLocalFile(t,s){const a=new FormData;t.to&&a.append("to",t.to),t.group&&a.append("group",t.group);for(const[e,s]of Object.entries(t))"boolean"!=typeof s?a.append(e,s):a.append(e,s?"1":"0");const n=e.default.readFileSync(s.localPath),r=new Blob([n],{type:"audio/wav"});return a.append("file",r,"vms.wav"),a}formatSmsDetails(t){const e=t;return t.date&&(e.dateValidate=!0,e.date=t.date.toISOString()),t.expirationDate&&(e.expirationDate=t.expirationDate.toISOString()),n(e,t=>/param[1-4]/.test(t)?t:"noUnicode"===t?t.toLowerCase():r(t))}formatResponse(t){return{...t,list:t.list.map(t=>({...t,dateSent:new Date(1e3*t.dateSent),points:"string"==typeof t.points?parseFloat(t.points):t.points}))}}},C=class extends f{endpoint="/mms.do";async sendMms(t,e,s,a){return await this.send({smil:s,subject:e},{to:t},a)}async sendMmsToGroup(t,e,s,a){return await this.send({smil:s,subject:e},{group:t},a)}},b=class extends s{async get(){return await this.httpClient.get("/profile")}},v=class extends s{async get(){const t=await this.httpClient.get("/sms/sendernames");return{...t,collection:t.collection.map(this.formatSendernameDates)}}async getBySender(t){const e=await this.httpClient.get(`/sms/sendernames/${t}`);return this.formatSendernameDates(e)}async create(t){const e=await this.httpClient.post("/sms/sendernames",{sender:t});return this.formatSendernameDates(e)}async makeDefault(t){await this.httpClient.post(`/sms/sendernames/${t}/commands/make_default`)}async remove(t){await this.httpClient.delete(`/sms/sendernames/${t}`)}formatSendernameDates(t){return{...t,createdAt:new Date(t.createdAt)}}},S=class extends f{endpoint="/sms.do";async sendSms(t,e,s){return await this.send({message:e},{to:t},s)}async sendFlashSms(t,e,s){return await this.sendSms(t,e,{...s,flash:!0})}async sendSmsToGroup(t,e,s){return await this.send({message:e},{group:t},s)}async sendFlashSmsToGroup(t,e,s){return await this.sendSmsToGroup(t,e,{...s,flash:!0})}async removeScheduledSms(t){const e=Array.isArray(t)?t.join(","):t;return await this.httpClient.post(this.endpoint,{format:"json",sch_del:e})}},x=class extends s{async get(){return await this.httpClient.get("/subusers")}async getById(t){return await this.httpClient.get(`/subusers/${t}`)}async create(t){const{credentials:e,points:s}=t;return await this.httpClient.post("/subusers",{...t,credentials:{api_password:e.apiPassword,password:e.password,username:e.username},points:s?{from_account:s.fromAccount,per_month:s.perMonth}:void 0})}async update(t,e){const{credentials:s,points:a}=e;return await this.httpClient.put(`/subusers/${t}`,{...e,credentials:s&&(s.password||s.apiPassword)?{api_password:s.apiPassword,password:s.password}:void 0,points:a&&(a.fromAccount||a.perMonth)?{from_account:a.fromAccount,per_month:a.perMonth}:void 0})}async remove(t){await this.httpClient.delete(`/subusers/${t}`)}},A=class extends s{async get(){return await this.httpClient.get("/sms/templates")}async getById(t){return await this.httpClient.get(`/sms/templates/${t}`)}async create(t){return await this.httpClient.post("/sms/templates",t)}async update(t,e){return await this.httpClient.put(`/sms/templates/${t}`,e)}async remove(t){await this.httpClient.delete(`/sms/templates/${t}`)}},$=class extends f{endpoint="/vms.do";async sendVms(t,e,s,a){return await this.send({tts:e,ttsLector:s},{to:t},a)}async sendVmsWithLocalFile(t,e,s){return await this.send({localPath:e},{to:t},s)}async sendVmsWithRemoteFile(t,e,s){return await this.send({remotePath:e},{to:t},s)}async sendVmsToGroup(t,e,s,a){return await this.send({tts:e,ttsLector:s},{group:t},a)}async sendVmsWithLocalFileToGroup(t,e,s){return await this.send({localPath:e},{group:t},s)}async sendVmsWithRemoteFileToGroup(t,e,s){return await this.send({remotePath:e},{group:t},s)}},D=t=>{const e=t.replace(/[-_\s.]+(.)?/g,(t,e)=>e?e.toUpperCase():"");return e.substring(0,1).toLowerCase()+e.substring(1)},T=t=>n(t,D),j=t=>{const e=T(t);return Object.entries(e).forEach(([t,s])=>{s instanceof Date||(Array.isArray(s)?e[t]=s.map(t=>!a(t)||t instanceof Date?t:T(t)):a(s)&&(e[t]=T(s)))}),e},R=class extends Error{constructor(t,e,s,a,n){super(t),this.status=e,this.statusText=s,this.responseBody=a,this.url=n,this.name="HttpError"}},_=class{baseUrl;defaultHeaders;requestInterceptors=[];responseInterceptors=[];constructor(t,e={}){this.baseUrl=t.replace(/\/$/,""),this.defaultHeaders={"Content-Type":"application/json",...e}}addRequestInterceptor=t=>{this.requestInterceptors.push(t)};addResponseInterceptor=t=>{this.responseInterceptors.push(t)};buildUrl=(t,e)=>{const s=new URL(`${this.baseUrl}/${t.replace(/^\//,"")}`);return e&&Object.entries(e).forEach(([t,e])=>{s.searchParams.append(t,String(e))}),s.toString()};runRequestInterceptors(t){let e=t;for(const t of this.requestInterceptors)e=t(e);return e}runResponseInterceptors(t){let e=t;for(const t of this.responseInterceptors)e=t(e);return e}async makeRequest(t,e,s,a={}){const{headers:n={},params:r}=a;let i={body:s,headers:{...this.defaultHeaders,...n},method:t,params:r,url:e};i=this.runRequestInterceptors(i);const o={headers:i.headers,method:i.method};s&&"GET"!==t&&"HEAD"!==t&&(i.body instanceof FormData?(delete o.headers["Content-Type"],o.body=i.body):i.body instanceof Buffer?o.body=i.body:o.body=JSON.stringify(i.body));const c=await fetch(this.buildUrl(i.url,i.params),o);if(!c.ok){const t=await c.text();throw new R(`Request failed with status ${c.status}: ${c.statusText}`,c.status,c.statusText,t,c.url)}let p;const h=c.headers.get("content-type");if(null==h?void 0:h.includes("application/json")){p={data:await c.json(),headers:c.headers,status:c.status,statusText:c.statusText}}else{p={data:await c.text(),headers:c.headers,status:c.status,statusText:c.statusText}}return p=this.runResponseInterceptors(p),(t=>{const{data:e}=t;return e?Array.isArray(e)?e.map(j):(t=>!!t.collection&&!!t.size)(e)?{...e,collection:e.collection.map(j)}:(t=>!!t.list&&!!t.count)(e)?{...e,list:e.list.map(j)}:j(e):e})(p)}get=(t,e)=>this.makeRequest("GET",t,void 0,e);post=(t,e,s)=>this.makeRequest("POST",t,e,s);put=(t,e,s)=>this.makeRequest("PUT",t,e,s);patch=(t,e,s)=>this.makeRequest("PATCH",t,e,s);delete=(t,e)=>this.makeRequest("DELETE",t,void 0,e)};exports.SMSAPI=class{accessToken;serviceUrl;httpClient;contacts;hlr;mfa;mms;profile;sendernames;sms;subusers;templates;vms;constructor(t,e){this.accessToken=t,this.serviceUrl=e??"https://smsapi.io/api",this.httpClient=this.getHttpClient(),this.contacts=new l(this.getHttpClient()),this.hlr=new m(this.httpClient),this.mfa=new y(this.httpClient),this.mms=new C(this.httpClient),this.profile=new b(this.httpClient),this.sendernames=new v(this.httpClient),this.sms=new S(this.httpClient),this.subusers=new x(this.httpClient),this.templates=new A(this.httpClient),this.vms=new $(this.httpClient)}getUserAgent(){return"smsapi/js-client:2.1.3"}getHttpClient(){return new _(this.serviceUrl,{Accept:"application/json",Authorization:`Bearer ${this.accessToken}`,"User-Agent":this.getUserAgent()})}};